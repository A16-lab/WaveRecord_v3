НАЗНАЧЕНИЕ:                                                                                                                                                                        
Программа WaveRecord2 предназначена для работы с AnalogDiscovery 2 с целью генерации/записи высокочастотных сигналов.                                                              
Длительность сигналов ограничена возможностью буфера AnalogDiscovery 2,                                                                                                            
8192 – отсчета на прием, 4096 – отсчёта на излучение, частота дискретизации до 100 МГц.                                                                                            
                                                                                                                                                                                   
                                                                                                                                                                                   
ВОЗМОЖНОСТИ:                                                                                                                                                                       
- Программа позволяет задавать в качестве излучаемого сигнала: радиоимпульс (монохром) или ЛЧМ (sweep),                                                                            
  или сигнал произвольной формы, заданный в файле (InPut.dat).                                                                                                                     
- По результатам измерений формируется текстовый файл '%Y-%m-%dT%H%M%S.dat', имя файла содержит время измерений.                                                                   
  В файл записаны все данные измерений необходимые для восстановления результатов измерений, а также конфигурационный файл измерения,                                              
  файл описания результатов измерений. Содержание файла является смешанным: преамбула – текст, результаты измерений бинарные данные.                                               
- На данный момент: излучение/прием реализованы для двух каналов, формы излучаемого импульса идентичны для обоих каналов в случае радиоимпульса и ЛЧМ,                             
  в случае задания произвольного сигнала в виде файла зависимость формы импульса для каждого канала может быть задана индивидуально.                                               
                                                                                                                                                                                   
                                                                                                                                                                                   
ЗАДАЮТСЯ:                                                                                                                                                                          
- форма импульса (fm_type = 0 монохром, fm_type = 1 ЛЧМ, fm_type = 2 произвольная);                                                                                                
- временные параметры импульса (монохром - fi_Hz [Гц] несущая частота, ЛЧМ - {f0_Hz, f1_Hz} [Гц] начальная и конечная частота спектра);                                            
- количество отсчетов на излучение (nSamplesOut <= 4096), количество отсчетов на прием (nSamplesIn <= 8192);                                                                       
- шаг дискретизации по времени для излучения (fsOut_Hz [Гц]) и отдельно шаг дискретизации по времени для приема (fsIn_Hz [Гц])                                                     
  (ADC и DAC работают на временной сетке 100 МГц, соответственно шаг дискретизации должен быть кратен это частоте);                                                                
- амплитуды излучаемых сигналов для каждого канала ({MaxVolts0, MaxVolts1} <= 5[V]);                                                                                               
- максимальное время пробега волны (DT0 задается в абстрактных единицах [tick]: DT0 < 512 + 32768);                                                                                
- время задержки начало приема относительно момента излучения (DT1 задается в абстрактных единицах [tick]: DT1 < DT0 - 1);                                                         
- масштаб временной шкалы (TimeScale = {1, 2, 5, 10, 20, 50, 100, 200, 500, 1000}) определяющий величину одного tick = TimeScale * 1 [мксек];                                      
- праметры чувствительности ADC (voltsRange0, voltsRange1 [V]) отдельно для каждого канала,                                                                                        
 если voltsRange = 5.0 [V] то чувствительность ADC = 0.32mV/отсчет, если voltsRange = 50.0 [V] то чувствительность ADC = 3.58mV/отсчет;                                            
- количество циклов излучения/приема в рамках одного измерения TotalPing (не нормируется);                                                                                         
- интервал между циклами излучения/приема в рамках одного измерения TimeDelay [мсек] (не нормируется),                                                                             
  реальное время между циклами излучения/приема необходимо оценивать при помощи осциллографа по интервалам времени                                                                 
  между импульсами на цифровом выводе D0, ориентировочно время между циклами излучения/приема ~ 40 [мсек] + TimeDelay [мсек].                                                      
                                                                                                                                                                                   
                                                                                                                                                                                   
СХЕМА ПОДКЛЮЧЕНИЯ:                                                                                                                                                                 
Аналоговые входы/выходы (приема/излучения) могут быть подключены непосредственно или через плату расширения (BNC разъемы);                                                         
Земля подключается через плату расширения или непосредственно;                                                                                                                     
Необходимо подключить:                                                                                                                                                             
цифровой вывод D0 <-> вход триггера Trig1;                                                                                                                                         
цифровой вывод D1 <-> вход триггера Trig2;                                                                                                                                         
цифровой вывод D2 используется для внешнего запуска серии измерения;                                                                                                               
Параметры запускающего импульса следующие - одиночный импульс, напряжение до 3.3 [В], старт измерений по заднему спадающему фронту через 1.5 мсек.                                
                                                                                                                                                                                   
                                                                                                                                                                                   
АЛГОРИТМ РАБОТЫ:                                                                                                                                                                   
После прихода внешнего тактового импулься на цифровой пин D2 (3.3 [В]), по спадающему фронту тактового импульса происходит серия измерений.                                        
Всего проводится TotalPing измерений в одной серии измерений. Количество серий измерений не ограничено.                                                                            
Интервал между сериями измерений не менее 1 сек, что успеть записать файл с другим именем.                                                                                         
Через интервалы времени TimeScale*DT0 [мксек], на цифровой вывод D0 подается тактовый импульс, по которому производиться излучение.                                                
После тактового импульса на D0, через интервал времени TimeScale*DT1 [мксек] подается тактовый импульс на цифровой вывод D1, по которому производится регистрация данных.          
Цифровой вывод D0 подключен ко входу триггера Trig1, по сигналу на триггере Trig1 происходит излучение.                                                                            
Цифровой вывод D1 подключен ко входу триггера Trig2, по сигналу на триггере Trig2 происходит регистрация данных.                                                                   
Таким образом временной интервал TimeScale * DT1 [мксек], это время задержки между излучением и приемом.                                                                           
Временной интервал TimeScale * DT0 [мксек] определяет максимальную задержку между началом излучения и началом приема данных.                                                       
                                                                                                                                                                                   
                                                                                                                                                                                   
ОСОБЕННОСТИ РАБОТЫ:                                                                                                                                                                
По всей видимости АЦП AnalogDiscovery 2 работает на частоте 100 МГц, и существует случайная задержка                                                                               
порядка 220 [нсек] между восходящим фронтом (rasing edge)сигнала на входе триггера Trig2 и началом записи данных.                                                                  
Для удобства на пин питания V+ выведено напряжения +3.3[В]/0.1[A] что может быть использовано для формирования схемы гальванической развязки D2 от внешней аппаратуры. 2           
                                                                                                                                                                                   
                                                                                                                                                                                   
ОПЦИИ ПРОГРАММЫ:                                                                                                                                                                   
WaveRecord3.exe --help	                => выводит данную справку, и сохраняет ее в виде файла READ-ME.TXT;                                                                         
WaveRecord3.exe --file config.dat      => запускает программу на исполнение c параметрами, заданными в конфигурационном файле 'config.dat';                                        
WaveRecord3.exe --example              => записывает пример файла конфигурации 'config.dat' и пример скрипта, matlab-а 'plotResult2.m',                                            
                                          который строит результаты измерений на основе файла '%Y-%m-%dT%H%M%S.dat',                                                              
                                          а также содержит пример формирования файла InPut.dat.                                                                                   
                                                                                                                                                                                   
                                                                                                                                                                                   
НЕОБХОДИМЫЕ ДЛЯ РАБОТЫ ФАЙЛЫ:                                                                                                                                                      
                                                                                                                                                                                   
Обязательные:                                                                                                                                                                      
‘WaveRecord3.exe’ – исполняемый файл, до запуска в работу,                                                                                                                         
                    желательно проверить подключение AnalogDiscovery 2 с помощью штатной программы WaveForms;                                                                      
                                                                                                                                                                                   
‘config.dat’ – файл задания конфигурационных параметров измерений;                                                                                                                 
                                                                                                                                                                                   
‘plotResult3.m’ – файл с кодом matlab-а для считывания данных результатов измерений;                                                                                               
                                                                                                                                                                                   
Дополнительные:                                                                                                                                                                    
‘DESCR.TXT’ – текстовый файл, в произвольной форме, с описанием проводимых измерений.                                                                                              
              Содержание данного файла включается в файл результатов измерений %Y-%m-%dT%H%M%S.dat.                                                                                
              Файл DESCR.TXT - НЕ ДОЛЖЕН СОДЕРЖАТЬ строку вида «===============»,                                                                                                  
              поскольку она используется в файле результатов для разделения текстовых данных от бинарных.                                                                          
                                                                                                                                                                                   
                                                                                                                                                                                   
                                                                                                                                                                                   
ФОРМАТ ФАЙЛОВ:                                                                                                                                                                     
‘config.dat’ - задается до начала измерений                                                                                                                                        
// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
5            % TimeScale     // 1 => (1 tick == 1 us); 10 => (1 tick == 10 us); 100 => (1 tick == 0.1 ms); 1000 => (1 tick == 1 ms);                                               
1000         % DT0  [tick]   //Max value = 512 + 32768 [tick]; The DT0 Must be: (DT0 > WAVE PROPAGATION TIME)                                                                      
0            % DT1  [tick]   //Must be DT1: DT1 < DT0 - PULSE_WIDTH, where PULSE_WIDTH == 1; The time delay between radiation and reception                                        
25           % TotalPing     //The total number of measurement series                                                                                                              
10           % TimeDelay     //The measurments series param. // [ms] Time delay between measurments series, real time delay ~ 40 ms + TimeDelay                                    
3.75         % MaxVolts0     //[V] MaxVolts0 <= 5; DAC0 range                                                                                                                      
2.5          % MaxVolts1     //[V] MaxVolts1 <= 5; DAC1 range                                                                                                                      
50.0         % voltsRange0   //[V] voltsRange0 = {5.0 OR 50.0}; ADC0 range; If ADC range = 5.0 [V] => ADC resolution = 0.32mV; If ADC range = 50.0 [V] => ADC resolution = 3.58mV; 
50.0         % voltsRange1   //[V] voltsRange1 = {5.0 OR 50.0}; ADC1 range; If ADC range = 5.0 [V] => ADC resolution = 0.32mV; If ADC range = 50.0 [V] => ADC resolution = 3.58mV; 
0            % fm_type       //The emission signal type // fm_type = 0 -> mono pulse; fm_type = 1 -> sweep pulse; fm_type = 2 -> custom (read from file)                           
12500000.0   % fi_Hz         //[Hz] The carrier frequency of the monochromatic pulse                                                                                               
10000000.0   % f0_Hz         //[Hz] Start frequency band of sweep signal                                                                                                           
12500000.0   % f1_Hz         //[Hz] Stop frequency band of sweep signal                                                                                                            
4000         % nSamplesOut   //nSamplesOut <= 4096;                                                                                                                                
8192         % nSamplesIn    //nSamplesIn <= 8192;                                                                                                                                 
100000000.0  % fsIn_Hz       //[Hz] Input sampling frequency - частота дискретизации входного сигнала                                                                              
100000000.0  % fsOut_Hz      //[Hz] Output sampling frequency - частота дискретизации выходного сигнала                                                                            
// -------------------------------------------------------------------------------------------------------------------------------------------------------------------             
                                                                                                                                                                                   
// --- Параметры, определяющие задержку момента начала записи сигналов относительно момента излучения --------------------                                                         
uint32 TimeScale - определяет временную шкалу для {DT0, DT1}, если TimeScale = 1, {DT0, DT1} задается в [мксек] (1 tick == 1 [мксек]),                                             
                   если TimeScale = 1000, {DT0, DT1} задается в [мсек] (1 tick == 1 [мсек]);                                                                                       
uint32 DT0 [tick] - интервал времени, который должен быть больше чем время задержки момента измерения относительно момента излучения, ограничения: DT0 < 512 + 32768;              
uint32 DT1 [tick] - интервал времени между моментом излучения и моментом начала записи сигналов, ограничения DT1 < DT0 - 1;                                                        
                                                                                                                                                                                   
// --- Параметры, определяющие количество циклов излучения/приема и интервал времени между циклами измерений -------------                                                         
uint32 TotalPing - общее количество циклов излучения/приема, в рамках одной серии не нормируется;                                                                                  
uint32 TimeDelay - устаревший параметр, оставлен для совместимости                                                                                                                 
Интервал времени [мсек] между циклами измерений (излучения/приема), определяется произведением TimeScale*DT0 [мксек],                                                               
                                                                                                                                                                                   
// --- Параметры, определяющие конфигурацию каналов ADC/DAC --------------------------------------------------------------                                                         
double MaxVolts0    [V] - амплитуда сигнала [V] DAC0, ограничения MaxVolts0 <= 5[V];                                                                                               
double MaxVolts1    [V] - амплитуда сигнала [V] DAC1, ограничения MaxVolts1 <= 5[V];                                                                                               
double voltsRange0  [V] - voltsRange0 = {5.0 или 50.0} динамический диапазон ADC0, заданный диапазон соответствует 14 битам шкалы ADC;                                             
double voltsRange1  [V] - voltsRange1 = {5.0 или 50.0} динамический диапазон ADC1, заданный диапазон соответствует 14 битам шкалы ADC;                                             
                                                                                                                                                                                   
// --- Параметры, определяющие форму излучаемого сигнала DAC --------------------------------------------------------------                                                        
uint32 fm_type - определяет тип излучаемого сигнала {0 - монохром, 1 - ЛЧМ, 2 - задается файлом InPut.dat}                                                                         
double fi_Hz [Hz] - несущая частота радиоимпульса;                                                                                                                                 
double f0_Hz [Hz] - начальная частота ЛЧМ спектра;                                                                                                                                 
double f1_Hz [Hz] - конечная частота ЛЧМ спектра;                                                                                                                                  
                                                                                                                                                                                   
// --- Параметры определяющие временную сетку ADC/DAC -------------------------------------------------------------------                                                          
uint32 nSamplesOut [smpl] - количество отсчетов в излучаемом сигнале, ограничения nSamplesOut <= 4096;                                                                             
uint32 nSamplesIn  [smpl] - количество отсчетов в принимаемом сигнале, ограничения nSamplesIn <= 8192;                                                                             
double fsIn_Hz     [Hz]   - частотная сетка ADC, ограничения fsIn_Hz должна быть кратна 100 МГц;                                                                                   
double fsOut_Hz    [Hz]   - частотная сетка DAC, ограничения fsOut_Hz должна быть кратна 100 МГц;                                                                                  
                                                                                                                                                                                   
                                                                                                                                                                                   
'InPut.dat' - задается до измерений, описывает форму сигналов, подаваемых на DAC0, DAC1                                                                                            
// ------------------------------------------------------------------------------                                                                                                  
 0.0000000e+00 0.0000000e+00                                                                                                                                                       
 6.2831440e-03 1.2566040e-02                                                                                                                                                       
 1.2566040e-02 2.5130095e-02                                                                                                                                                       
 1.8848440e-02 3.7690183e-02                                                                                                                                                       
 2.5130095e-02 5.0244318e-02                                                                                                                                                       
 3.1410759e-02 6.2790520e-02                                                                                                                                                       
 3.7690183e-02 7.5326806e-02                                                                                                                                                       
 4.3968118e-02 8.7851197e-02                                                                                                                                                       
 5.0244318e-02 1.0036171e-01                                                                                                                                                       
 5.6518534e-02 1.1285638e-01                                                                                                                                                       
 6.2790520e-02 1.2533323e-01                                                                                                                                                       
 6.9060026e-02 1.3779029e-01                                                                                                                                                       
 .......................................................                                                                                                                           
// ------------------------------------------------------------------------------                                                                                                  
первый столбец - нормированная к единице форма сигнала, подаваемого на DAC0                                                                                                        
второй столбец - нормированная к единице форма сигнала, подаваемого на DAC1                                                                                                        
                                                                                                                                                                                   
Амплитуда сигналов описывается параметрами {MaxVolts0, MaxVolts1} файла 'config.dat';                                                                                              
Временная сетка описывается параметром fsOut_Hz файла 'config.dat';                                                                                                                
Число отсчетов (строк файла) должно соответствовать параметру nSamplesOut файла 'config.dat', быть больше;                                                                         
                                                                                                                                                                                   
